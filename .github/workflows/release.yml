name: Release

on:
    push:
        tags:
            - 'v*.*.*'  # Match semantic versioning tags like v1.0.0

jobs:
    build-and-release:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout Code
              uses: actions/checkout@v4

            - name: Set up Python
              uses: actions/setup-python@v4
              with:
                    python-version: '3.12'  # Specify the Python version

            - name: Install Dependencies
              run: |
                    python -m pip install --upgrade pip
                    pip install -r requirements-dev.txt

            - name: Build binary
              run: |
                    PYTHONPATH=. python -m PyInstaller synth/cli.py \
                    --onefile \
                    --name synthgen \
                    --add-data "legal/EULA_v1.0.txt:."

            - name: Create checksum
              run: sha256sum dist/synthgen > dist/synthgen.sha256

            - name: Debug list contents
              run: ls -lah dist/

            - name: Publish Release
              uses: softprops/action-gh-release@v1
              with:
                  tag_name: ${{ github.ref }}
                  files: |
                        dist/synthgen
                        dist/synthgen.sha256
                        legal/EULA_v1.0.txt
